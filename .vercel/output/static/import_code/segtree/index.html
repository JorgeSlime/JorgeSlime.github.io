<!DOCTYPE html><pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#6A737D">//nose haber si da</span></span>
<span class="line"><span style="color:#6A737D">//SegmentTree_Base </span></span>
<span class="line"><span style="color:#F97583">template</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#F97583">class</span><span style="color:#B392F0"> Info</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> SegTree</span><span style="color:#E1E4E8">{ </span></span>
<span class="line"><span style="color:#F97583">public:</span><span style="color:#E1E4E8"> </span></span>
<span class="line"><span style="color:#F97583">    using</span><span style="color:#B392F0"> inf</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> Info</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">    using</span><span style="color:#B392F0"> T</span><span style="color:#F97583"> =</span><span style="color:#F97583"> typename</span><span style="color:#B392F0"> inf</span><span style="color:#E1E4E8">::</span><span style="color:#B392F0">Type</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">    using</span><span style="color:#B392F0"> TP</span><span style="color:#F97583"> =</span><span style="color:#F97583"> typename</span><span style="color:#B392F0"> inf</span><span style="color:#E1E4E8">::</span><span style="color:#B392F0">Type_pos</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">    #define</span><span style="color:#B392F0"> left</span><span style="color:#E1E4E8"> node </span><span style="color:#F97583">&#x3C;&#x3C;</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8"> </span></span>
<span class="line"><span style="color:#F97583">    #define</span><span style="color:#B392F0"> right</span><span style="color:#E1E4E8"> node </span><span style="color:#F97583">&#x3C;&#x3C;</span><span style="color:#79B8FF"> 1</span><span style="color:#F97583"> |</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8"> </span></span>
<span class="line"><span style="color:#6A737D">    // --------------- datos---------------------</span></span>
<span class="line"><span style="color:#B392F0">    std</span><span style="color:#E1E4E8">::vector</span><span style="color:#F97583">&#x3C;</span><span style="color:#E1E4E8">Info</span><span style="color:#F97583">></span><span style="color:#E1E4E8"> Tree;</span></span>
<span class="line"><span style="color:#E1E4E8">    TP log,size;</span></span>
<span class="line"><span style="color:#6A737D">    // ------------------------------------------</span></span>
<span class="line"><span style="color:#F97583">    explicit</span><span style="color:#B392F0"> SegTree</span><span style="color:#E1E4E8">() : </span><span style="color:#B392F0">size</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">TP</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">)) {}</span></span>
<span class="line"><span style="color:#F97583">    explicit</span><span style="color:#B392F0"> SegTree</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">TP</span><span style="color:#FFAB70"> tam</span><span style="color:#E1E4E8">) : </span><span style="color:#B392F0">size</span><span style="color:#E1E4E8">(tam) {</span></span>
<span class="line"><span style="color:#E1E4E8">        log </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">        while</span><span style="color:#E1E4E8">((</span><span style="color:#79B8FF">1</span><span style="color:#F97583">&#x3C;&#x3C;</span><span style="color:#E1E4E8">log) </span><span style="color:#F97583">&#x3C;</span><span style="color:#E1E4E8"> size) </span><span style="color:#F97583">++</span><span style="color:#E1E4E8">log;</span></span>
<span class="line"><span style="color:#E1E4E8">        size </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 1</span><span style="color:#F97583">&#x3C;&#x3C;</span><span style="color:#E1E4E8">log;</span></span>
<span class="line"><span style="color:#E1E4E8">        Tree.</span><span style="color:#B392F0">assign</span><span style="color:#E1E4E8">(size</span><span style="color:#F97583">&#x3C;&#x3C;</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">,{</span><span style="color:#B392F0">inf</span><span style="color:#E1E4E8">::</span><span style="color:#B392F0">neutral</span><span style="color:#E1E4E8">()});</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#F97583">    explicit</span><span style="color:#B392F0"> SegTree</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">std</span><span style="color:#E1E4E8">::</span><span style="color:#B392F0">vector</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">T</span><span style="color:#E1E4E8">> </span><span style="color:#F97583">&#x26;</span><span style="color:#FFAB70">ar</span><span style="color:#E1E4E8">){</span></span>
<span class="line"><span style="color:#E1E4E8">        size </span><span style="color:#F97583">=</span><span style="color:#B392F0"> sz</span><span style="color:#E1E4E8">(ar);    </span></span>
<span class="line"><span style="color:#E1E4E8">        log </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">        while</span><span style="color:#E1E4E8">((</span><span style="color:#79B8FF">1</span><span style="color:#F97583">&#x3C;&#x3C;</span><span style="color:#E1E4E8">log)</span><span style="color:#F97583">&#x3C;</span><span style="color:#E1E4E8">size) </span><span style="color:#F97583">++</span><span style="color:#E1E4E8">log;</span></span>
<span class="line"><span style="color:#E1E4E8">        size </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 1</span><span style="color:#F97583">&#x3C;&#x3C;</span><span style="color:#E1E4E8">log;</span></span>
<span class="line"><span style="color:#E1E4E8">        Tree.</span><span style="color:#B392F0">assign</span><span style="color:#E1E4E8">(size</span><span style="color:#F97583">&#x3C;&#x3C;</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">,{</span><span style="color:#B392F0">inf</span><span style="color:#E1E4E8">::</span><span style="color:#B392F0">neutral</span><span style="color:#E1E4E8">()});</span></span>
<span class="line"><span style="color:#B392F0">        init</span><span style="color:#E1E4E8">(ar);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#F97583">    void</span><span style="color:#B392F0"> set</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">int</span><span style="color:#FFAB70"> k</span><span style="color:#E1E4E8">, </span><span style="color:#B392F0">Info</span><span style="color:#FFAB70"> x</span><span style="color:#E1E4E8">) { Tree[k </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> size] </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> x; }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    Info</span><span style="color:#F97583"> &#x26;operator</span><span style="color:#B392F0">[]</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">const</span><span style="color:#B392F0"> TP</span><span style="color:#F97583"> &#x26;</span><span style="color:#FFAB70">pos</span><span style="color:#E1E4E8">) { </span><span style="color:#F97583">return</span><span style="color:#E1E4E8"> Tree[pos </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> size]; }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    inline</span><span style="color:#F97583"> constexpr</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> modify</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">T</span><span style="color:#FFAB70"> node</span><span style="color:#E1E4E8">){</span></span>
<span class="line"><span style="color:#E1E4E8">        Tree[node] </span><span style="color:#F97583">=</span><span style="color:#B392F0"> inf</span><span style="color:#E1E4E8">::</span><span style="color:#B392F0">Merge</span><span style="color:#E1E4E8">(Tree[left],Tree[right]);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    void</span><span style="color:#B392F0"> init</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">const</span><span style="color:#B392F0"> std</span><span style="color:#E1E4E8">::</span><span style="color:#B392F0">vector</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">T</span><span style="color:#E1E4E8">> </span><span style="color:#F97583">&#x26;</span><span style="color:#FFAB70">ar</span><span style="color:#E1E4E8">){</span></span>
<span class="line"><span style="color:#E1E4E8">        i32 tam </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (i32)ar.</span><span style="color:#B392F0">size</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">auto</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; i</span><span style="color:#F97583">&#x3C;</span><span style="color:#E1E4E8">tam ; i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8">) Tree[size </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> i]</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#E1E4E8">            ar[i]</span></span>
<span class="line"><span style="color:#E1E4E8">        };</span><span style="color:#6A737D"> // cantidad de operaciones</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">int</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> size </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8"> ; i ; i</span><span style="color:#F97583">--</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">modify</span><span style="color:#E1E4E8">(i);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    void</span><span style="color:#B392F0"> update</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">TP</span><span style="color:#FFAB70"> node</span><span style="color:#E1E4E8">, </span><span style="color:#B392F0">TP</span><span style="color:#FFAB70"> nl</span><span style="color:#E1E4E8">, </span><span style="color:#B392F0">TP</span><span style="color:#FFAB70"> nr</span><span style="color:#E1E4E8">, </span><span style="color:#B392F0">TP</span><span style="color:#FFAB70"> pos</span><span style="color:#E1E4E8">,</span><span style="color:#B392F0">T</span><span style="color:#FFAB70"> v</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8">(nl </span><span style="color:#F97583">></span><span style="color:#E1E4E8"> pos </span><span style="color:#F97583">||</span><span style="color:#E1E4E8"> nr </span><span style="color:#F97583">&#x3C;</span><span style="color:#E1E4E8"> pos) </span><span style="color:#F97583">return</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8">(nr</span><span style="color:#F97583">==</span><span style="color:#E1E4E8">nl) {</span></span>
<span class="line"><span style="color:#E1E4E8">            Tree[node] </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> {v};</span><span style="color:#6A737D"> //asignacion </span></span>
<span class="line"><span style="color:#E1E4E8">        } </span></span>
<span class="line"><span style="color:#F97583">        else</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">            T mid </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (nl </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> nr) </span><span style="color:#F97583">>></span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">            if</span><span style="color:#E1E4E8">(pos </span><span style="color:#F97583">&#x3C;=</span><span style="color:#E1E4E8"> mid) </span><span style="color:#B392F0">update</span><span style="color:#E1E4E8">(left, nl, mid, pos, v);</span></span>
<span class="line"><span style="color:#F97583">            else</span><span style="color:#B392F0"> update</span><span style="color:#E1E4E8">(right, mid </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">, nr, pos, v);</span></span>
<span class="line"><span style="color:#B392F0">            modify</span><span style="color:#E1E4E8">(node);</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    void</span><span style="color:#B392F0"> update</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">TP</span><span style="color:#FFAB70"> pos</span><span style="color:#E1E4E8"> ,</span><span style="color:#B392F0">TP</span><span style="color:#FFAB70"> val</span><span style="color:#E1E4E8">){</span></span>
<span class="line"><span style="color:#B392F0">        update</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, size</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, pos, val);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    Info</span><span style="color:#B392F0"> query</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">TP</span><span style="color:#FFAB70"> node</span><span style="color:#E1E4E8">, </span><span style="color:#B392F0">TP</span><span style="color:#FFAB70"> nl</span><span style="color:#E1E4E8">, </span><span style="color:#B392F0">TP</span><span style="color:#FFAB70"> nr</span><span style="color:#E1E4E8">, </span><span style="color:#B392F0">TP</span><span style="color:#FFAB70"> ql</span><span style="color:#E1E4E8">, </span><span style="color:#B392F0">TP</span><span style="color:#FFAB70"> qr</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (ql </span><span style="color:#F97583">&#x3C;=</span><span style="color:#E1E4E8"> nl </span><span style="color:#F97583">&#x26;&#x26;</span><span style="color:#E1E4E8"> nr </span><span style="color:#F97583">&#x3C;=</span><span style="color:#E1E4E8"> qr)  </span><span style="color:#F97583">return</span><span style="color:#E1E4E8"> Tree[node];</span></span>
<span class="line"><span style="color:#E1E4E8">        TP mid </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (nl </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> nr) </span><span style="color:#F97583">>></span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (qr </span><span style="color:#F97583">&#x3C;=</span><span style="color:#E1E4E8"> mid) </span><span style="color:#F97583">return</span><span style="color:#B392F0"> query</span><span style="color:#E1E4E8">(left, nl, mid, ql, qr);</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (ql </span><span style="color:#F97583">></span><span style="color:#E1E4E8"> mid) </span><span style="color:#F97583">return</span><span style="color:#B392F0"> query</span><span style="color:#E1E4E8">(right, mid </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">, nr, ql, qr);</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#B392F0"> inf</span><span style="color:#E1E4E8">::</span><span style="color:#B392F0">Merge</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">query</span><span style="color:#E1E4E8">(left, nl, mid, ql, qr), </span><span style="color:#B392F0">query</span><span style="color:#E1E4E8">(right, mid </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">, nr, ql, qr));</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    Info</span><span style="color:#B392F0"> query</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">TP</span><span style="color:#FFAB70"> l</span><span style="color:#E1E4E8">, </span><span style="color:#B392F0">TP</span><span style="color:#FFAB70"> r</span><span style="color:#E1E4E8">){</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#B392F0"> query</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, size</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, l, r);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // nos falta aprender min_right  &#x26; max_left :(</span></span>
<span class="line"><span style="color:#E1E4E8">};</span></span>
<span class="line"><span style="color:#6A737D">//-------------------Monoides----------------------</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">//-------------------------------------------------</span></span>
<span class="line"><span style="color:#F97583">template</span><span style="color:#E1E4E8"> &#x3C;</span><span style="color:#F97583">typename</span><span style="color:#B392F0"> X</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> Node</span><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#F97583">public:</span><span style="color:#E1E4E8"> </span></span>
<span class="line"><span style="color:#F97583">    using</span><span style="color:#B392F0"> Type</span><span style="color:#F97583">=</span><span style="color:#B392F0">X</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">    using</span><span style="color:#B392F0"> Type_pos</span><span style="color:#F97583">=</span><span style="color:#B392F0">i32</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6A737D">    //-------------------Monoides----------------------</span></span>
<span class="line"><span style="color:#F97583">    using</span><span style="color:#B392F0"> op</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> </span></span>
<span class="line"><span style="color:#6A737D">    //-------------------------------------------------</span></span>
<span class="line"><span style="color:#F97583">    static</span><span style="color:#F97583"> constexpr</span><span style="color:#B392F0"> Node</span><span style="color:#B392F0"> Merge</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">const</span><span style="color:#B392F0"> Node</span><span style="color:#F97583"> &#x26;</span><span style="color:#FFAB70">x</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">const</span><span style="color:#B392F0"> Node</span><span style="color:#F97583"> &#x26;</span><span style="color:#FFAB70">y</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">noexcept</span><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">            op</span><span style="color:#E1E4E8">::(x.val,y.val)</span></span>
<span class="line"><span style="color:#E1E4E8">        };</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#6A737D">    //NULL val para cada tipo de operacion </span></span>
<span class="line"><span style="color:#F97583">    static</span><span style="color:#F97583"> constexpr</span><span style="color:#B392F0"> Node</span><span style="color:#B392F0"> neutral</span><span style="color:#E1E4E8">() { </span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#B392F0">            op</span><span style="color:#E1E4E8">::</span><span style="color:#B392F0">neutral</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">        };</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#6A737D">    //----------------variables----------------</span></span>
<span class="line"><span style="color:#E1E4E8">    X val;</span></span>
<span class="line"><span style="color:#E1E4E8">};</span></span></code></pre>